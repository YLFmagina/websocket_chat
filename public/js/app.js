// Generated by CoffeeScript 1.6.3
(function() {
  jQuery(function() {
    var ws;
    $.fn.editable.defaults.mode = 'inline';
    $('textarea').emojiarea({
      buttonLabel: '插入表情',
      buttonPosition: 'before'
    });
    $('#username').editable({
      type: 'text',
      pk: 1,
      url: '/username',
      title: 'Enter username'
    });
    $('#username').on('save', function(e, params) {
      return location.reload();
    });
    ws = new WebSocket("ws://0.0.0.0:8080");
    ws.onmessage = function(evt) {
      $('#chat tbody').append('<tr><td>' + evt.data + '</td></tr>');
      return $('.msg').scrollTop(400);
    };
    ws.onclose = function() {
      return ws.send("Leaves the chat");
    };
    ws.onopen = function() {
      return ws.send("Join the chat");
    };
    $("form").submit(function(e) {
      if ($("#msg").val().length > 0) {
        ws.send($(".emoji-wysiwyg-editor").html());
        $("#msg").val("");
        $(".emoji-wysiwyg-editor").empty();
      }
      return false;
    });
    $(document).live('keydown', function(e) {
      if (e.ctrlKey && e.keyCode === 13) {
        return $('form').trigger('submit');
      }
    });
    return $("#clear").click(function() {
      return $('#chat tbody tr').remove();
    });
  });

}).call(this);
